<html>
	<head>
		<title>Starting Code for 1st Project 2017 - with lights and textures</title>
		<style>

		body {
			font-family: Monospace;
			background-color: #f0f0f0;
			margin: 0px;
			overflow: hidden;
		}

		canvas {
			width: 100%;
			height: 100%;
		}

	</style>
		<script src="lib/three.min.js"></script>
		<script src="lib/stats.min.js"></script>
		<script src="lib/Coordinates.js"></script>
		<script src="lib/OrbitControls.js"></script>
		<script src="models/macchina_completa.js"></script>
		<script src="models/albero.js"></script>

	</head>
	<body>

		<script>

		var scene, camera, renderer, controls, stats;
		var xSpeed = 0.4;
		var ySpeed = 0.4;
		var collision=false;
		var testo2;
		var macchine= new Array(10);
		var crash=false;
		

		
	/*	var macchina_completa;
		var ruota;
		var ruotaGeometry;
		var ruotaMaterial;
		var muso;
		var musoGeometry;
		var musoMaterial;
		var corpo;
		var corpoGeometry;
		var corpoMaterial;
		var alaAnteriore;
		var alaAnterioreGeometry;
		var alaAnterioreMaterial;
		var retro;
		var retroGeometry;
		var retroMaterial;
		var alettone;
		var alettoneGeometry;
		var alettoneMaterial;
		var tetto;
		var tettoGeometry;
		var tettoMaterial;

		var colore;
		*/
		//var loader = new THREE.OBJLoader();
		
		function Start() {

			scene = new THREE.Scene();
			camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

			renderer = new THREE.WebGLRenderer( {antialias: true} );
			renderer.setSize( window.innerWidth, window.innerHeight );
			renderer.setClearColor( 0xf0f0f0 );
			renderer.setPixelRatio( window.devicePixelRatio );
			renderer.gammaInput = true;
			renderer.gammaOutput = true;
			renderer.shadowMap.enabled = true;
			document.body.appendChild( renderer.domElement );

			camera.position.set(-15,4,5);
			camera.lookAt( new THREE.Vector3(0,0,0));

			var geometry = new THREE.BoxGeometry(1,1,1);
			var texture = THREE.ImageUtils.loadTexture('textures/11635.jpg');
			var material = new THREE.MeshPhongMaterial( { map: texture } );
			var cube = new THREE.Mesh( geometry, material );
			cube.castShadow = true;
			cube.receiveShadow = true;

			//scene.add( cube );

			hemiLight = new THREE.HemisphereLight( 0xffffff, 0xffffff, 0.6 );
			hemiLight.color.setHSL( 0.6, 1, 0.6 );
			hemiLight.groundColor.setHSL( 0.095, 1, 0.75 );
			hemiLight.position.set( 0, 500, 0 );
			scene.add( hemiLight );

			dirLight = new THREE.DirectionalLight( 0xffffff, 1 );
			dirLight.color.setHSL( 0.1, 1, 0.95 );
			dirLight.position.set( -1, 1.75, 1 );
			dirLight.position.multiplyScalar( 50 );
			scene.add( dirLight );
			dirLight.castShadow = true;
			dirLight.shadow.mapSize.width = 1024;
			dirLight.shadow.mapSize.height = 1024;


			// GROUND
			var groundGeo = new THREE.PlaneBufferGeometry( 10000, 10000 );
			var groundMat = new THREE.MeshPhongMaterial( { color: 0xffffff, specular: 0x050505 } );
			groundMat.color.setHSL( 0.095, 1, 0.75 );
			var ground = new THREE.Mesh( groundGeo, groundMat );
			ground.position.y = -0.5;
			ground.rotation.x = -Math.PI/2;
			scene.add( ground );
			ground.receiveShadow = true;

			stats = new Stats();
			stats.domElement.style.position = 'absolute';
			stats.domElement.style.top = '0px';
			document.body.appendChild( stats.domElement );

			// uncomment if you need to draw coordinate axes when building the scene
			Coordinates.drawAllAxes();

			controls = new THREE.OrbitControls( camera );
			//controls.addEventListener( 'change', Render );
			
			for (var i=0;i<10;i++){
				macchine[i]=creaMacchinaCompleta();
				scene.add(macchine[i]);
				macchine[i].position.set(getRandomInt(450,50),0,getRandomInt(10,-10));
				//macchine[i].rotation.y=Math.PI;
			}		
			macchinaCompleta=creaMacchinaCompleta();
			//let macchinaCompleta=macchinaCompletaGeometry.getMacchinaCompleta();
			scene.add(macchinaCompleta);
			macchinaCompleta.position.set(0,0,5);

			albero = creaAlbero();
			scene.add(albero);
			albero.position.set(100,4,1);

			var fontLoader = new THREE.FontLoader();
			fontLoader.load( 'fonts/helvetiker_bold.typeface.json', function ( font ) {

			var testo = new THREE.TextGeometry( 'GAME OVER', {
				font: font,
				size: 10,
				height: 5,
				curveSegments: 6,
			} );
			
			var colore2=new THREE.Color();
			colore2.setRGB(255,250,250);
			var textMaterial= new THREE.MeshBasicMaterial({ color: colore2 });
    		testo2 = new THREE.Mesh(testo , textMaterial);
			scene.add(testo2);
			testo2.position.set(0,100,0);
			testo2.rotation.y=Math.PI/(2/3);
			
			
		} );
			


		/*	//inizio here

			macchina_completa = new THREE.Object3D();

			colore=(Math.random()*0xffffff);

			corpoGeometry = new THREE.BoxGeometry(4,1,2);
			corpoMaterial = new THREE.MeshBasicMaterial({ color: colore, side: THREE.DoubleSide } );
			corpo=new THREE.Mesh(corpoGeometry,corpoMaterial);
			corpo.position.set(-1,0,0);

			musoGeometry = new THREE.BoxGeometry(3,1,1);
			musoMaterial = new THREE.MeshBasicMaterial({ color: colore, side: THREE.DoubleSide } );
			muso=new THREE.Mesh(musoGeometry,musoMaterial);
			//muso.add(tetto);
			muso.position.set(2.5,0,0);

			alaAnterioreGeometry=new THREE.BoxGeometry(1,1,3);
			alaAnterioreMaterial = new THREE.MeshBasicMaterial({ color: colore, side: THREE.DoubleSide } );
			alaAnteriore=new THREE.Mesh(alaAnterioreGeometry,alaAnterioreMaterial);
			alaAnteriore.position.set(4.5,0,0);

			retroGeometry=new THREE.BoxGeometry(3,1,1);
			retroMaterial = new THREE.MeshBasicMaterial({ color: colore, side: THREE.DoubleSide } );
			retro=new THREE.Mesh(retroGeometry,retroMaterial);
			retro.position.set(-4.5,0,0);

			tettoGeometry=new THREE.BoxGeometry(3,1,1)
			tettoMaterial = new THREE.MeshBasicMaterial({ color: colore, side: THREE.DoubleSide } );
			tetto=new THREE.Mesh(tettoGeometry,tettoMaterial);
			tetto.position.set(-2,1,0);

			alettone=new THREE.Mesh(alaAnterioreGeometry,alaAnterioreMaterial); //alettone=ala anteriore
			alettone.position.set(-5.5,1,0);

			ruotaGeometry=new THREE.BoxGeometry(1,1,1);
			ruotaMaterial = new THREE.MeshBasicMaterial({ color: 0x000000, side: THREE.DoubleSide } );
			ruota=[];
			for (i=0; i<4; i++){
				ruota[i] = new THREE.Mesh(ruotaGeometry,ruotaMaterial);
				macchina_completa.add(ruota[i]);
			}
			ruota[0].position.set(2.5,0,1);
			ruota[1].position.set(2.5,0,-1);
			ruota[2].position.set(-4,0,1);
			ruota[3].position.set(-4,0,-1);


			macchina_completa.add(tetto);
			macchina_completa.add(alettone);
			macchina_completa.add(retro);
			macchina_completa.add(alaAnteriore);
			macchina_completa.add(muso);
			macchina_completa.add(corpo);
			macchina_completa.position.set(-50,0,0)
			*/
			//scene.add(macchina_completa);

		}
		function detectCollisionCubes(object1, object2){
			object1.geometry.computeBoundingBox(); //not needed if its already calculated
  			object2.geometry.computeBoundingBox();
  			object1.updateMatrixWorld();
  			object2.updateMatrixWorld();
  
  			var box1 = object1.geometry.boundingBox.clone();
  			box1.applyMatrix4(object1.matrixWorld);

  			var box2 = object2.geometry.boundingBox.clone();
			box2.applyMatrix4(object2.matrixWorld);
			  
			return box1.intersectsBox(box2);
		}
		
		function Update() {
			//console.log("HIT");
			
			
			
		for (var i=0;i<10;i++){
		if(detectCollisionCubes(macchinaCompleta,macchine[i])==true){
			console.log("HIT");
			macchine[i].position.x=-1500;
			crash=true;
			
			
			testo2.position.y=5;
					testo2.translateZ(-50);
					testo2.translateX(-40);
			
		/*	for(i=0;i<100;i++){
			macchinaCompleta.rotation.z=Math(PI*i);
			setTimeout(0.01);
		*/	
			
		}else{
			macchine[i].position.x -=0.9;
			
		}
		}
				//if(crash==true){
					

			//	}
				requestAnimationFrame( Update );
				//controls.update();
				stats.update();
				
				Render();
		
			
		}
		//}
		function getRandomInt(max,min) {
			var a;
			a=Math.floor(Math.random() * Math.floor(max));
			if (a<min){
			}else{
 		 return a 
			}
		}

		function Render() {

			renderer.render(scene, camera);
		}

		
		document.addEventListener("keydown", onDocumentKeyDown, false);
		
		function onDocumentKeyDown(event) { //WASD to move
		var keyCode = event.which;
		if (keyCode == 87) {
			macchinaCompleta.position.x += ySpeed;
		} else if (keyCode == 83) {
			macchinaCompleta.position.x -= ySpeed;
		} else if (keyCode == 65) {
			macchinaCompleta.position.z -= xSpeed;
		} else if (keyCode == 68) {
			macchinaCompleta.position.z += xSpeed;
		} else if (keyCode == 32) {
			macchinaCompleta.position.set(0, 0, 0);
		}
		
		};

		Start();
		Update();
		
		

		</script>
	</body>
</html>
